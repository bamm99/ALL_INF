<body data-current-user-id="<%= current_user.id %>" class="is-flex is-flex-direction-column h-full">
  <div class='container'>
    <header class="has-text-centered">
      <h1 class="regularTitle">./all_inf</h1>
      <h2 class="regularsubTittle"> Dashboard de Administración </h2>
    </header>

    <nav>
      <%= render 'shared/adminnavbar' %>
    </nav>

    <div class="is-flex is-flex-grow-1 columns p-2 mb-2 mt-1">
      <!-- Sidebar -->
      <div class="column is-one-quarters box p-4 ml-4 is-flex is-flex-direction-column box_main">
        <%= render 'shared/adminsidebar' %>
      </div>
      <!-- Área de Contenido Principal -->
      <div class="column is-three-quarters box p-4 mx-4 mb-5 is-flex is-flex-direction-column box_main">
        <div>
          <h1>Estadísticas</h1>
          <%= form_with url: admin_statistics_path, method: :get, local: true do %>
            <div class="field">
              <label class="label">Seleccionar tipo de gráfico</label>
              <div class="control">
                <div class="select">
                  <%= select_tag :chart_type, options_for_select([['Cantidad de veces que se terminaron cursos en cada mes del último año', 'courses_completed_per_month'], ['Cursos completados por mes', 'course_completions_by_month'], ['Distribución de usuarios por universidad', 'user_distribution_by_university'], ['Distribución de materiales de estudio por categoría', 'study_materials_distribution_by_category'], ['Distribución de usuarios por carrera y universidad', 'user_distribution_by_degree_and_university']], params[:chart_type]), onchange: 'this.form.submit();' %>
                </div>
              </div>
            </div>
            <% if @chart_type == 'course_completions_by_month' %>
              <div class="field">
                <label class="label">Seleccionar mes</label>
                <div class="control">
                  <%= month_field_tag :month, params[:month], onchange: 'this.form.submit();', class: 'input' %>
                </div>
              </div>
            <% elsif @chart_type == 'user_distribution_by_degree_and_university' %>
              <div class="field">
                <label class="label">Seleccionar Universidad</label>
                <div class="control">
                  <%= select_tag :university_id, options_from_collection_for_select(University.all, :id, :name, params[:university_id]), onchange: 'this.form.submit();', class: 'input' %>
                </div>
              </div>
            <% end %>
          <% end %>

          <% if @chart_data.present? %>
            <div id="chart-container" style="width: 100%; height: 400px;" data-chart-data="<%= @chart_data.to_json %>" data-chart-type="<%= @chart_type %>">
              <canvas id="myChart"></canvas>
            </div>
          <% else %>
            <p>No hay datos para el mes seleccionado.</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <%= render 'shared/screenwarning' %>
</body>
